<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic Tac Toe</title>
  <style>
     * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(45deg, #00f0ff, #00ff9d, #ff00d0, #ff6600);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: sans-serif;
      padding: 20px;
      flex-direction: column;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .game-container {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 30px 40px;
      max-width: 400px;
      width: 100%;
      text-align: center;
    }

    h1 {
      margin-bottom: 10px;
      font-size: 2rem;
    }

    .info {
      font-size: 1rem;
      margin-bottom: 15px;
      color: #333;
      font-weight: 600;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-gap: 15px;
      margin: 20px 0;
    }

    .cell {
      background: #e1e1e1;
      border-radius: 12px;
      cursor: pointer;
      font-size: 2.5rem;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 80px;
      user-select: none;
      transition: background-color 0.3s ease;
    }

    .cell.taken {
      cursor: default;
      background-color: #ccc;
    }

    .cell:focus {
      outline: 2px solid #1976d2;
      outline-offset: 2px;
    }

    .status {
      font-weight: 600;
      font-size: 1.1rem;
      min-height: 32px;
      margin-top: 10px;
    }

    button {
      background-color: #1976d2;
      border: none;
      padding: 12px 36px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 1rem;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 20px;
    }

    button:hover {
      background-color: #1257a1;
    }

    /* Dialog styles */
    .dialog-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      animation-fill-mode: forwards;
    }

    .dialog-overlay.show {
      opacity: 1;
      pointer-events: auto;
      animation: fadeIn 0.3s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .dialog {
      background: white;
      border-radius: 15px;
      padding: 30px 40px;
      max-width: 340px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.25);
      user-select: none;
    }

    .dialog h2 {
      margin-bottom: 15px;
      font-size: 1.8rem;
      font-weight: 700;
      color: #1976d2;
    }

    .dialog p {
      font-size: 1rem;
      margin-bottom: 25px;
      color: #555;
    }

    .dialog button {
      background-color: #1976d2;
      color: white;
      padding: 12px 36px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 1rem;
      border: none;
      cursor: pointer;
      margin: 8px 10px;
      min-width: 80px;
      transition: background-color 0.3s ease;
    }

    .dialog button:hover {
      background-color: #1257a1;
    }

    /* Selection groups for difficulty and symbol in same dialog */
    .selection-group {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .selection-group label {
      font-weight: 600;
      margin-right: 10px;
      width: 100%;
      text-align: left;
      font-size: 1.1rem;
      color: #333;
      margin-bottom: 8px;
      user-select: none;
    }

    .selection-group button {
      background-color: #f0f0f0;
      color: #333;
      border: 2px solid transparent;
      padding: 10px 18px;
      margin: 8px 10px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 70px;
      user-select: none;
    }

    .selection-group button:hover {
      background-color: #d0d0d0;
    }

    .selection-group button.selected {
      background-color: #1976d2; /* stronger blue */
      color: white;
      border-color: #1257a1;
      box-shadow: 0 0 8px rgba(25, 118, 210, 0.7);
    }

    /* Result dialog buttons container */
    .result-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .cell.win {
      background-color: #1976d2 !important;
      color: white;
      box-shadow: 0 0 10px #1976d2;
    }

    /* Keep all existing CSS here (omitted for brevity, unchanged) */
    /* You can use the original CSS you posted in your question */
  </style>
</head>
<body>
  <!-- HTML content remains unchanged -->

  <!-- The entire body content you originally posted remains the same -->
  <!-- Replace only the <script> part with the following updated script -->
<div class="game-container" role="main" aria-label="Tic Tac Toe game">
    <h1>Tiki-Toc</h1>
    <div class="info" id="gameInfo" aria-live="polite" aria-atomic="true">
      <!-- Difficulty and symbol info displayed here -->
    </div>
    <div class="board" id="board" role="grid" aria-label="Tic Tac Toe Board" tabindex="0">
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 1" data-index="0"></div>
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 2" data-index="1"></div>
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 3" data-index="2"></div>
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 4" data-index="3"></div>
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 5" data-index="4"></div>
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 6" data-index="5"></div>
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 7" data-index="6"></div>
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 8" data-index="7"></div>
      <div class="cell" role="gridcell" tabindex="0" aria-label="Cell 9" data-index="8"></div>
    </div>
    <div class="status" id="status" aria-live="polite" aria-atomic="true">Loading...</div>
    <button id="restartBtn" style="display:none;">Restart Game</button>
  </div>

  <!-- Combined Selection Dialog for Difficulty and Symbol -->
  <div class="dialog-overlay" id="selectionOverlay" role="alertdialog" aria-modal="true" aria-labelledby="selectionTitle" aria-describedby="selectionDesc" tabindex="-1">
    <div class="dialog" role="document">
      <h2 id="selectionTitle">Select Difficulty and Symbol</h2>
      <p id="selectionDesc">Choose the difficulty level and your symbol to start the game.</p>

      <div class="selection-group" aria-label="Select Difficulty">
        <label>Difficulty:</label>
        <button data-difficulty="easy" type="button">Easy</button>
        <button data-difficulty="medium" type="button">Medium</button>
        <button data-difficulty="hard" type="button">Hard</button>
        <button data-difficulty="extreme" type="button">Extreme</button>
      </div>

      <div class="selection-group" aria-label="Select Symbol">
        <label>Symbol:</label>
        <button data-symbol="X" type="button">X</button>
        <button data-symbol="O" type="button">O</button>
      </div>

      <button id="startGameBtn" disabled type="button" aria-disabled="true">Start Game</button>
    </div>
  </div>

  <!-- Result Dialog -->
  <div class="dialog-overlay" id="resultOverlay" role="alertdialog" aria-modal="true" aria-labelledby="resultTitle" aria-describedby="resultDesc" tabindex="-1" aria-live="assertive" aria-atomic="true">
    <div class="dialog" role="document">
      <h2 id="resultTitle">Game Over</h2>
      <p id="resultDesc"></p>
      <div class="result-buttons">
        <button id="playAgainBtn" type="button">Play Again</button>
        <button id="changeSettingsBtn" type="button">Change Settings</button>
      </div>
    </div>
  </div>


<script>
  const boardElement = document.getElementById('board');
  const statusElement = document.getElementById('status');
  const restartBtn = document.getElementById('restartBtn');
  const gameInfo = document.getElementById('gameInfo');

  const selectionOverlay = document.getElementById('selectionOverlay');
  const resultOverlay = document.getElementById('resultOverlay');

  const startGameBtn = document.getElementById('startGameBtn');

  let board = Array(9).fill('');
  let human = '';
  let bot = '';
  let currentPlayer = '';
  let gameOver = false;
  let difficulty = '';

  const difficultyButtons = [...selectionOverlay.querySelectorAll('[data-difficulty]')];
  const symbolButtons = [...selectionOverlay.querySelectorAll('[data-symbol]')];

  const winCombos = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  function loadSettings() {
    difficulty = sessionStorage.getItem('difficulty') || '';
    human = sessionStorage.getItem('symbol') || '';

    if (difficulty && human) {
      bot = (human === 'X') ? 'O' : 'X';
      updateGameInfo();
      hideOverlay(selectionOverlay);
      startGame();
    } else {
      showOverlay(selectionOverlay);
    }
  }

  function updateGameInfo() {
    gameInfo.textContent = `Difficulty: ${capitalize(difficulty)} | Your Symbol: ${human}`;
  }

  function capitalize(str) {
    return str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
  }

  function showOverlay(overlay) {
    overlay.classList.add('show');
    overlay.focus();
  }

  function hideOverlay(overlay) {
    overlay.classList.remove('show');
  }

  function updateSelectionButtons() {
    difficultyButtons.forEach(btn => {
      btn.classList.toggle('selected', btn.getAttribute('data-difficulty') === difficulty);
    });
    symbolButtons.forEach(btn => {
      btn.classList.toggle('selected', btn.getAttribute('data-symbol') === human);
    });

    startGameBtn.disabled = !(difficulty && human);
    startGameBtn.setAttribute('aria-disabled', startGameBtn.disabled.toString());
  }

  difficultyButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      difficulty = btn.getAttribute('data-difficulty');
      updateSelectionButtons();
    });
  });

  symbolButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      human = btn.getAttribute('data-symbol');
      bot = (human === 'X') ? 'O' : 'X';
      updateSelectionButtons();
    });
  });

  startGameBtn.addEventListener('click', () => {
    sessionStorage.setItem('difficulty', difficulty);
    sessionStorage.setItem('symbol', human);
    updateGameInfo();
    hideOverlay(selectionOverlay);
    startGame();
  });

  function startGame() {
    board = Array(9).fill('');
    gameOver = false;
    currentPlayer = human;
    statusElement.textContent = `Your turn (${human})`;

    document.querySelectorAll('.cell').forEach(cell => {
      cell.classList.remove('win');
    });

    updateBoard();
  }

  function updateBoard() {
    document.querySelectorAll('.cell').forEach((cell, i) => {
      cell.textContent = board[i];
      cell.classList.toggle('taken', board[i] !== '');
      cell.setAttribute('aria-label', `Cell ${i+1} ${board[i] ? ', occupied by ' + board[i] : ', empty'}`);
    });
  }

  function makeMove(index, player) {
    if (board[index] !== '' || gameOver) return;
    board[index] = player;
    updateBoard();

    const winningCombo = checkWin(player);
    if (winningCombo) {
      gameOver = true;
      highlightWin(winningCombo);
      setTimeout(() => {
        showResult(player === human ? 'You win!' : 'Bot wins!');
      }, 800);
      return;
    }

    if (board.every(cell => cell !== '')) {
      gameOver = true;
      setTimeout(() => {
        showResult("It's a draw!");
      }, 400);
      return;
    }

    currentPlayer = (player === human) ? bot : human;

    if (currentPlayer === bot) {
      statusElement.textContent = "Bot's turn...";
      setTimeout(botMove, 500);
    } else {
      statusElement.textContent = `Your turn (${human})`;
    }
  }

  function checkWin(player) {
    return winCombos.find(combo => combo.every(i => board[i] === player)) || null;
  }

  function highlightWin(combo) {
    combo.forEach(i => {
      const cell = document.querySelector(`.cell[data-index="${i}"]`);
      if (cell) cell.classList.add('win');
    });
  }

  function showResult(message) {
    document.getElementById('resultDesc').textContent = message;
    showOverlay(resultOverlay);
    statusElement.textContent = message;
  }

  function botMove() {
    if (gameOver) return;
    
    let move = null;
    if (difficulty === 'easy') {
      move = randomMove();
    } else if (difficulty === 'medium') {
      move = findWinning(bot) || findWinning(human) || randomMove();
    } else if (difficulty === 'hard') {
      move = findWinning(bot) || findWinning(human) || takeCenter() || takeCorner() || takeSide() || randomMove();
    } else if (difficulty === 'extreme') {
      move = findWinning(bot) || findWinning(human) || takeCenter() || takeOppCorner() || takeCorner() || takeSide();
      if (move === null) move = blockPlayerWinOrRandom();
    }
    makeMove(move, bot);
  }

  function randomMove() {
    const empty = board.map((val, i) => val === '' ? i : null).filter(i => i !== null);
    return empty[Math.floor(Math.random() * empty.length)];
  }

  function findWinning(player) {
    for (let i = 0; i < 9; i++) {
      if (board[i] === '') {
        board[i] = player;
        if (checkWin(player)) {
          board[i] = '';
          return i;
        }
        board[i] = '';
      }
    }
    return null;
  }

  function takeCenter() {
    return board[4] === '' ? 4 : null;
  }

  function takeCorner() {
    return [0, 2, 6, 8].find(i => board[i] === '');
  }

  function takeOppCorner() {
    const pairs = [[0, 8], [2, 6]];
    for (const [a, b] of pairs) {
      if (board[a] === human && board[b] === '') return b;
      if (board[b] === human && board[a] === '') return a;
    }
    return null;
  }

  function takeSide() {
    return [1, 3, 5, 7].find(i => board[i] === '');
  }

  function blockPlayerWinOrRandom() {
    let blockMove = findWinning(human);
    return blockMove !== null ? blockMove : randomMove();
  }

  boardElement.addEventListener('click', e => {
    if (!e.target.classList.contains('cell') || currentPlayer !== human) return;
    const index = +e.target.dataset.index;
    makeMove(index, human);
  });

  boardElement.addEventListener('keydown', e => {
    if (currentPlayer !== human) return;

    const focusEl = document.activeElement;
    if (!focusEl.classList.contains('cell')) return;

    let index = +focusEl.dataset.index;

    switch (e.key) {
      case 'ArrowRight':
        e.preventDefault();
        focusCell((index + 1) % 9);
        break;
      case 'ArrowLeft':
        e.preventDefault();
        focusCell((index + 8) % 9);
        break;
      case 'ArrowDown':
        e.preventDefault();
        focusCell((index + 3) % 9);
        break;
      case 'ArrowUp':
        e.preventDefault();
        focusCell((index + 6) % 9);
        break;
      case 'Enter':
      case ' ':
        e.preventDefault();
        makeMove(index, human);
        break;
    }
  });

  function focusCell(i) {
    const cells = document.querySelectorAll('.cell');
    if (cells[i]) cells[i].focus();
  }

  document.getElementById('playAgainBtn').addEventListener('click', () => {
    hideOverlay(resultOverlay);
    startGame();
  });

  document.getElementById('changeSettingsBtn').addEventListener('click', () => {
    hideOverlay(resultOverlay);
    showOverlay(selectionOverlay);
  });

  loadSettings();
  updateSelectionButtons();

</script>
</body>
</html>
